<div class="container">
  <div>
    <h2><i class="fas fa-database"></i> Dataset</h2>

    <!-- Tabs: Data | Graph variants | Edit -->
    <div class="tabs">
      <button type="button" class="tab" [class.active]="activeTab() === 'data'" (click)="activeTab.set('data')">
        <i class="fas fa-table"></i> Data
      </button>
      <button type="button" class="tab" [class.active]="activeTab() === 'graph' && graphType() === 'actual'"
              (click)="setGraphType('actual')">
        <i class="fas fa-chart-line"></i> Graph: Actual
      </button>
      <button type="button" class="tab" [class.active]="activeTab() === 'graph' && graphType() === 'target'"
              (click)="setGraphType('target')">
        <i class="fas fa-bullseye"></i> Graph: Target
      </button>
      <button type="button" class="tab" [class.active]="activeTab() === 'graph' && graphType() === 'endDate'"
              (click)="setGraphType('endDate')">
        <i class="fas fa-calendar-alt"></i> Graph: End Date
      </button>
      <button type="button" class="tab" [class.active]="activeTab() === 'edit'" (click)="activeTab.set('edit')">
        <i class="fas fa-pen"></i> Edit
      </button>
    </div>

    <!-- Data tab: Entries table -->
    <div *ngIf="activeTab() === 'data'">
      <h3>Entries</h3>
      <table class="table">
        <thead>
        <tr>
          <th>Label</th>
          <th style="width: 220px;">Value</th>
          <th style="width: 220px;">Date</th>
          <th style="width: 300px;">Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td><input type="text" [(ngModel)]="newEntry.label" placeholder="Label"/></td>
          <td><input type="number" [(ngModel)]="newEntry.value" placeholder="Value"/></td>
          <td><input type="date" [(ngModel)]="newEntry.date" (click)="openPicker($event)"/></td>
          <td>
            <button class="btn btn-primary" type="button" (click)="addEntry()"><i class="fas fa-plus"></i> Add</button>
            <button class="btn btn-secondary" type="button" (click)="resetNewEntry()"><i class="fas fa-broom"></i> Clear
            </button>
          </td>
        </tr>

        <tr *ngFor="let e of entries">
          <td><input type="text" [(ngModel)]="e.label"/></td>
          <td><input type="number" [(ngModel)]="e.value"/></td>
          <td><input type="date" [(ngModel)]="e.date" (click)="openPicker($event)"/></td>
          <td>
            <button class="btn btn-primary" type="button" (click)="saveEntry(e)"><i class="fas fa-save"></i> Save
            </button>
            <button class="btn btn-danger" type="button" (click)="deleteEntry(e)"><i class="fas fa-trash-alt"></i>
              Delete
            </button>
          </td>
        </tr>

        <tr *ngIf="entriesLoading()">
          <td colspan="4">Loading entries...</td>
        </tr>
        </tbody>
      </table>
    </div>

    <!-- Graph tab -->
    <div class="chart-container" *ngIf="activeTab() === 'graph'">
      <ng-container *ngIf="graphLoading(); else graphContent">
        Loading graph...
      </ng-container>

      <ng-template #graphContent>
        <div *ngIf="chartData.length; else noData">
          <div class="chart-wrapper">
            <ngx-charts-line-chart
              [scheme]="colorScheme"
              [results]="chartData"
              [xAxis]="true"
              [yAxis]="true"
              [legend]="true"
              [legendPosition]="LegendPosition.Below"
              [showXAxisLabel]="true"
              [showYAxisLabel]="true"
              [xAxisLabel]="'Date'"
              [yAxisLabel]="'Value ' + (datasetSymbol ? '(' + datasetSymbol + ')' : '')"
              [autoScale]="true"
              [timeline]="true">
            </ngx-charts-line-chart>
          </div>
        </div>
        <ng-template #noData>No data to display.</ng-template>
      </ng-template>
    </div>

    <!-- Edit tab: reuse DatasetForm -->
    <div *ngIf="activeTab() === 'edit'">
      <app-dataset-form></app-dataset-form>
    </div>
  </div>
</div>
